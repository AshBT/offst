language: rust
sudo: required
git:
  depth: 1

# Don't cache the cargo registry:
# See: https://levans.fr/rust_travis_cache.html
before_cache:
    - rm -rf $HOME/.cargo/registry

cache:
  directories:
    - $HOME/.cargo
    - $HOME/install

matrix:
  fast_finish: true
  include:
  - env: RUST_BACKTRACE=1 TARGET=x86_64-pc-windows-msvc
    os: windows
    filter_secrets: false
    rust: nightly-2019-03-20
    before_script:
    # We install vcredist2010 as a requirement for the yasm assembler (Used for ring compilation)
    - choco install vcredist2010 capnproto strawberryperl 
    - mkdir -p $HOME/install/yasm
    - curl -o $HOME/install/yasm/yasm.exe https://www.tortall.net/projects/yasm/releases/yasm-1.3.0-win64.exe
    - export PATH=$HOME/install/yasm:$PATH
    - echo $PATH
    script:
        - cargo test
